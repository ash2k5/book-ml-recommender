{% extends "base.html" %}

{% block title %}{{ book.title }} - ML Book Recommender{% endblock %}

{% block content %}
<div class="container">
    <div class="breadcrumb">
        <a href="/" class="breadcrumb-link">
            <i class="fas fa-home"></i>
            Home
        </a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">{{ book.title }}</span>
    </div>

    <div class="book-detail-container">
        <div class="book-detail-main">
            <div class="book-header">
                <h1 class="book-detail-title">{{ book.title }}</h1>
                <p class="book-detail-author">by {{ book.author }}</p>
                <div class="book-detail-meta">
                    <span class="meta-item">
                        <i class="fas fa-tag"></i>
                        {{ book.genre }}
                    </span>
                    <span class="meta-item">
                        <i class="fas fa-star"></i>
                        {{ book.rating }}
                    </span>
                    <span class="meta-item">
                        <i class="fas fa-calendar"></i>
                        {{ book.year | int }}
                    </span>
                </div>
            </div>

            <div class="book-description">
                <h3>
                    <i class="fas fa-align-left"></i>
                    Description
                </h3>
                <p>{{ book.description }}</p>
            </div>
        </div>
    </div>

    <div class="recommendations-section">
        <div class="recommendations-header">
            <h2>
                <i class="fas fa-chart-line"></i>
                ML-Powered Recommendations
            </h2>
            <div class="ml-badge">
                <i class="fas fa-cogs"></i>
                Generated using TF-IDF & Cosine Similarity
            </div>
        </div>

        {% if recommendations %}
        <!-- ML-Based Content Recommendations -->
        <div class="recommendation-category">
            <h3 class="category-title">
                <i class="fas fa-chart-line"></i>
                Content-Based Recommendations
                <span class="category-badge">TF-IDF + Cosine Similarity</span>
            </h3>
            <div class="recommendations-grid">
                {% for rec in recommendations %}
                <div class="recommendation-card" onclick="viewBook('{{ rec.id }}')">
                    <div class="similarity-score">
                        <span class="score-value">{{ (rec.similarity_score * 100) | round }}%</span>
                        <span class="score-label">Match</span>
                    </div>
                    <div class="rec-content">
                        <h4 class="rec-title">{{ rec.title }}</h4>
                        <p class="rec-author">by {{ rec.author }}</p>
                        <div class="rec-meta">
                            <span class="rec-genre">
                                <i class="fas fa-tag"></i>
                                {{ rec.genre }}
                            </span>
                            <span class="rec-rating">
                                <i class="fas fa-star"></i>
                                {{ rec.rating }}
                            </span>
                        </div>
                        <p class="rec-description">{{ rec.description[:80] }}...</p>
                    </div>
                    <div class="rec-action">
                        <button class="btn-secondary">
                            <i class="fas fa-eye"></i>
                            View Details
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Same Genre Recommendations -->
        {% if same_genre_books %}
        <div class="recommendation-category">
            <h3 class="category-title">
                <i class="fas fa-tags"></i>
                More {{ current_genre }} Books
                <span class="category-badge">Genre-Based</span>
            </h3>
            <div class="recommendations-grid compact">
                {% for book in same_genre_books %}
                <div class="recommendation-card compact" onclick="viewBook('{{ book.id }}')">
                    <div class="rec-content">
                        <h4 class="rec-title">{{ book.title }}</h4>
                        <p class="rec-author">by {{ book.author }}</p>
                        <div class="rec-meta">
                            <span class="rec-rating">
                                <i class="fas fa-star"></i>
                                {{ book.rating }}
                            </span>
                            <span class="rec-year">
                                <i class="fas fa-calendar"></i>
                                {{ book.year | int }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Same Author Recommendations -->
        {% if same_author_books %}
        <div class="recommendation-category">
            <h3 class="category-title">
                <i class="fas fa-user-edit"></i>
                More by {{ current_author }}
                <span class="category-badge">Author-Based</span>
            </h3>
            <div class="recommendations-grid compact">
                {% for book in same_author_books %}
                <div class="recommendation-card compact" onclick="viewBook('{{ book.id }}')">
                    <div class="rec-content">
                        <h4 class="rec-title">{{ book.title }}</h4>
                        <div class="rec-meta">
                            <span class="rec-genre">
                                <i class="fas fa-tag"></i>
                                {{ book.genre }}
                            </span>
                            <span class="rec-rating">
                                <i class="fas fa-star"></i>
                                {{ book.rating }}
                            </span>
                            <span class="rec-year">
                                <i class="fas fa-calendar"></i>
                                {{ book.year | int }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="ml-explanation">
            <div class="explanation-content">
                <h3>
                    <i class="fas fa-question-circle"></i>
                    How These Recommendations Were Generated
                </h3>
                <div class="explanation-grid">
                    <div class="explanation-item">
                        <i class="fas fa-text-width"></i>
                        <div>
                            <strong>TF-IDF Vectorization</strong>
                            <p>Converted book text into numerical vectors using Term Frequency-Inverse Document Frequency</p>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <i class="fas fa-vector-square"></i>
                        <div>
                            <strong>Cosine Similarity</strong>
                            <p>Calculated mathematical similarity between book vectors in high-dimensional space</p>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <i class="fas fa-sort-numeric-down"></i>
                        <div>
                            <strong>Content-Based Filtering</strong>
                            <p>Ranked books by similarity score based on genre, theme, and textual content matching</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% else %}
        <div class="no-recommendations">
            <i class="fas fa-cogs"></i>
            <h3>No recommendations available</h3>
            <p>Our ML model couldn't find similar books. This may happen with unique or rare books.</p>
        </div>
        {% endif %}
    </div>

    <div class="back-to-home">
        <a href="/" class="btn-primary">
            <i class="fas fa-arrow-left"></i>
            Back to Book Collection
        </a>
    </div>
</div>
{% endblock %}